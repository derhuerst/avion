var MyAvionFile,__hasProp={}.hasOwnProperty,__extends=function(d,b){for(var a in b){if(__hasProp.call(b,a)){d[a]=b[a]}}function c(){this.constructor=d}c.prototype=b.prototype;d.prototype=new c();d.__super__=b.prototype;return d};MyAvionFile=(function(b){__extends(a,b);function a(c){a.__super__.constructor.call(this,c);this.dom=$("<tr></tr>");$("#transfer-table tbody").append(this.dom);this.dom.name=$("<td></td>").addClass("name").html(this.name);this.dom.append(this.dom.name);this.dom.size=$("<td></td>").addClass("size").html(this.prettyFileSize(this.size));this.dom.append(this.dom.size);this.dom.status=$("<td></td>").addClass("status");this.dom.append(this.dom.status);this.on("init",(function(d){return function(){d.dom.attr("class","init");return d.dom.status.html("")}})(this));this.on("wait",(function(d){return function(){d.dom.attr("class","wait");return d.dom.status.html("warten")}})(this));this.on("transfer",(function(d){return function(){d.dom.attr("class","transfer");return d.dom.status.html("senden")}})(this));this.on("complete",(function(d){return function(){d.dom.attr("class","complete");return d.dom.status.html("fertig")}})(this));this.on("error",(function(d){return function(){d.dom.attr("class","error");return d.dom.status.html("Fehler")}})(this));this.emit(this.status)}a.prototype.prettyFileSize=function(c){var e,d;e=Math.floor(Math.log(c)/Math.log(1024));d=c/Math.pow(1024,e);d*=Math.pow(10,e-1);d=Math.round(d);d/=Math.pow(10,e-1);return d+["b","k","m","g","t"][e]};return a})(Avion.File);var audio,body,peer;body=$(document.body);peer=new Avion.Peer();if(location.hash.length>1){body.addClass("receiver");peer.connect(location.hash.slice(1))}else{body.addClass("sender");$("#share-input").attr("value",location.href+"#"+peer.id)}peer.on("request",function(a){return peer.add(new MyAvionFile(a))});peer.on("ready",function(){return body.addClass("connected")});audio=$("#audio")[0];audio.volume=0.3;peer.on("progress",function(){audio.currentTime=0;return audio.play()});(function(){var b,a;b=$("#select-button input");b.on("change",function(i){var f,h,d,g,c;g=i.target.files;c=[];for(h=0,d=g.length;h<d;h++){f=g[h];c.push(peer.add(new MyAvionFile({mode:"send",file:f})))}return c});a=$("#select-drop");a.on("dragenter",function(c){return a.addClass("hover")});a.on("dragleave",function(c){return a.removeClass("hover")});a.on("dragover",function(c){c.preventDefault();return c.dataTransfer.dropEffect="copy"});return a.on("drop",function(i){var f,h,d,g,c;i.preventDefault();a.removeClass("hover");g=i.dataTransfer.files;c=[];for(h=0,d=g.length;h<d;h++){f=g[h];c.push(peer.add(new MyAvionFile({mode:"send",file:f})))}return c})})();(function(){var a;a=$("#share-input");return a.on("click",function(){this.select();return this.setSelectionRange(0,100)})})();